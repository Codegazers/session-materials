# Kubernetes Operators SDK Master Courses
This directory contains the files used in the demos for both sections of the DevNation Kubernetes Operators SDK Master Courses. The following is a quick breakdown of what you'll find in here and how to use it locally.

## Kafka Demo
The `/kafka-demo` directory has all of the components necessary to run the introduction demo on either Kubernetes or OpenShift.

When running on Kubernetes, start with `01-install-olm.sh`. This will install [Operator Lifecycle Manager](https://github.com/operator-framework/operator-lifecycle-manager) which is then used to install the Kafka Operator itself. When running against an OpenShift cluster, this step can be skipped.

The `02-install-kafka-operator.sh` script installs the operator itself. You can track that progress using the command `kubectl get csv -n operators` and following the status reported by its output.

Applying the `03-kafka.yaml` manifest creates a `Kafka` resource, which triggers the deployment of a full kafka cluster.

Applying the `04-topic.yaml` manifest adds a topic to the running cluster. You can verify its creation by connecting to one of the cluster pods (be careful to not use one of the zookeeper pods) and running `./bin/kafka-topics.sh --list --bootstrap-server localhost:9092`.

## Helm Demo
The `/helm` directory contains the full Helm chart that's used during the talk. If you're following along, once the Operator is created, replace everything in the generated chart's directory with the contents of this directory. I use the `copy-helm-chart.sh` script in the root directory of this session to simplify the process during the demo.

Alternatively, the full code for the Helm-based Operator can be found at https://github.com/jdob/visitors-helm-operator.

## Ansible Demo
Similarly, the `/ansible` directory has the full Ansible role used to deploy the Visitors application. The contents of this directory should fully replace the role generated by the Operator SDK. Again, I use a script during the session (`copy-ansible-role.sh`) to reduce the amount of typing needed.

The full code for the Ansible-based Operator can be found at https://github.com/jdob/visitors-ansible-operator.

## Go Demo
The `/go` directory contains the necessary code additions to the Go-based Operator. There are two different types of files within:

* The `controller` directory contains files that need to be copied into the Operator's `controller` package. Keep in mind that this code was written against an Operator that was generated with specific values. If you don't use the same name as the Operator or the same api-version/kind as I did, you'll need to modify these. For reference, the commands to create those are included below.
* The `controller-snippet` file contains the addition I made to the `Reconcile` method. This code simply calls out to the files copied over in the previous step to make sure they are run.

The following commands will replicate the Operator as I generated it during the session:
```
operator-sdk new visitors-operator
operator-sdk add api --api-version dobtech.io/v1 --kind VisitorsApp
operator-sdk add controller --api-version dobtech.io/v1 --kind VisitorsApp
```

The full code for the Go-based Operator can be found at https://github.com/jdob/visitors-operator.
